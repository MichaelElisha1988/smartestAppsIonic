<ion-content [fullscreen]="true">
  <section class="recepies">
    <div class="add-recipe-section">
        <button class="add-btn" (click)="toggleAddMode()"></button>
    </div>

    @if(isAddMode()) {
    <div class="add-recipe-overlay">
        <div class="add-recipe-container">
            <h3>Add New Recipe</h3>
            <form [formGroup]="addRecipeForm" (submit)="saveCustomRecipe()">
                <div class="form-scroll-container">
                    <input type="text" formControlName="strMeal" placeholder="Recipe Name" />
                    <input type="text" formControlName="strCategory" placeholder="Category" />
                    <input type="text" formControlName="strArea" placeholder="Area" />
                    <input type="text" formControlName="strMealThumb" placeholder="Image URL (optional)" />
                    <input type="text" formControlName="strYoutube" placeholder="Youtube Link (optional)" />
                    <textarea formControlName="strInstructions" placeholder="Instructions"></textarea>
                    <input type="text" formControlName="strTags" placeholder="Tags" />

                    <!-- Ingredients Section -->
                    <div class="ingredients-section" formArrayName="ingredients">
                        <h4>Ingredients</h4>
                        @for(group of ingredients.controls; track $index) {
                            <div [formGroupName]="$index" class="ingredient-row">
                                <input type="text" formControlName="ingredient" placeholder="Ingredient" />
                                <input type="text" formControlName="measure" placeholder="Measure" />
                                <button type="button" class="remove-btn" (click)="removeIngredient($index)">X</button>
                            </div>
                        }
                        <button type="button" class="add-ingredient-btn" (click)="addIngredient()">+ Add Ingredient</button>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" (click)="toggleAddMode()">Cancel</button>
                    <button type="submit" class="save-btn" [disabled]="!addRecipeForm.valid || ingredients.length === 0">Save Locally</button>
                </div>
            </form>
        </div>
    </div>
    }
    @if(selectedMeal()){
    <div class="recipie-item-big">
      <div
        class="tofavorite"
        (click)="
            notFav
              ? addTofavorite()
              : deleteFromFavorite()
          "
      >
        <img
          src="{{ notFav ? 'assets/favorite.png' : 'assets/delete.png' }}"
          alt=""
        />
      </div>
      <img
        class="back-img"
        src="{{ selectedMeal()!.strMealThumb }}"
        alt="steak"
      />
      <div class="blur-back-img"></div>
      <div class="recipie-info">
        <div class="recipie-category">{{ selectedMeal()!.strCategory }}</div>
        <div class="recipie-title">
          {{ selectedMeal()!.strMeal }} - {{ selectedMeal()!.strArea }}
          @if(selectedMeal()!.strTags) {
          <span class="tags"
            >, {{ selectedMeal()!.strTags.split(",")[0] }}</span
          >
          }
        </div>

        <div class="read-more" (click)="ViewuserDetail(selectedMeal()!)">
          Lets's cook it...
        </div>
      </div>
      <!-- <div class="lier-one"></div>
        <div class="lier-two"></div> -->
    </div>
    }

    <form class="recepies-search" [formGroup]="searchForm">
      <input
        type="text"
        formControlName="search"
        placeholder="What we cook today..."
      />
      @if(searchMealsInStok() && searchMealsInStok().length > 0) {
      <select
        name="searchMeals"
        id="searchMeals"
        class="searchMeals"
        formControlName="searchMeal"
      >
        @for (meal of searchMealsInStok(); track $index) {
        <option [value]="$index">{{ meal.strMeal }}</option>
        }
      </select>
      }
    </form>

    <div class="favorite-list-wrapper">
      <h2 class="favorite">Favorite :</h2>
      <div class="favorite-list">
        @for (meal of favoriteMealList(); track $index) {
        <div class="recipie-item-small">
          <img
            class="back-img"
            (click)="selectMeal(meal)"
            src="{{ meal.strMealThumb }}"
            alt="steak"
          />
        </div>
        }@empty {
        <div class="empty-favorite">
          <p>No favorite meals yet.</p>
        </div>
        }
      </div>
    </div>

    @if(tenMealsInStok){
    <div class="random-list-wrapper">
      <h2 class="random">Random Recipies :</h2>
      <div class="random-list">
        @for(meal of tenMealsInStok; track $index){
        <div class="recipie-item-small">
          <img
            class="back-img"
            (click)="selectMeal(meal)"
            src="{{ meal.strMealThumb }}"
            [alt]="meal.strMeal"
          />
        </div>
        }
      </div>
    </div>
    }
  </section>
</ion-content>
